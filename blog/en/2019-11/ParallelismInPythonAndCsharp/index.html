<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/blog/uploads/assets/icon200.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/assets/icon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/assets/icon16.png"><link rel="mask-icon" href="/blog/images/logo.svg" color="#222"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"zyxin.xyz","root":"/blog/en/","images":"/blog/en/images","scheme":"Muse","darkmode":false,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Disqus Comments"},"livere":{"text":"LiveRe Comments"}},"store":true,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/blog/js/config.js"></script><meta name="description" content="This post was written in Chinese and hasn&#39;t been translated to English yet.  近来由于项目需要，接触了一下一直没去了解过的 Python 异步语法，发现和之前我熟悉的 C# 有很多不同。在深入 Python 的异步逻辑之后，由于 Python 在语法上保留了很多语言机制的细节（比如成员函数的 self 参数），我反而对 C"><meta property="og:type" content="article"><meta property="og:title" content="进程、线程与协程 (C# vs Python)"><meta property="og:url" content="http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/index.html"><meta property="og:site_name" content="Jacob Zhong"><meta property="og:description" content="This post was written in Chinese and hasn&#39;t been translated to English yet.  近来由于项目需要，接触了一下一直没去了解过的 Python 异步语法，发现和之前我熟悉的 C# 有很多不同。在深入 Python 的异步逻辑之后，由于 Python 在语法上保留了很多语言机制的细节（比如成员函数的 self 参数），我反而对 C"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2019-11-07T05:57:31.000Z"><meta property="article:modified_time" content="2023-01-01T05:38:03.761Z"><meta property="article:author" content="Jacob Zhong"><meta property="article:tag" content="Python"><meta property="article:tag" content="C#"><meta property="article:tag" content="Parallelism"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/","path":"2019-11/ParallelismInPythonAndCsharp/","title":"进程、线程与协程 (C# vs Python)"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>进程、线程与协程 (C# vs Python) | Jacob Zhong</title><noscript><link rel="stylesheet" href="/blog/css/noscript.css"></noscript><link rel="alternate" href="/blog/atom.xml" title="Jacob Zhong" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/blog/en/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Jacob Zhong</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">b.zyxin.xyz</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/blog/en/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/blog/en/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">进程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">一些概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C"><span class="nav-number">1.2.</span> <span class="nav-text">C#</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python"><span class="nav-number">1.3.</span> <span class="nav-text">Python</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">线程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5-2"><span class="nav-number">2.1.</span> <span class="nav-text">一些概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-2"><span class="nav-number">2.2.</span> <span class="nav-text">C#</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-2"><span class="nav-number">2.3.</span> <span class="nav-text">Python</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">协程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5-3"><span class="nav-number">3.1.</span> <span class="nav-text">一些概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-3"><span class="nav-number">3.2.</span> <span class="nav-text">C#</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-3"><span class="nav-number">3.3.</span> <span class="nav-text">Python</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Jacob Zhong" src="/blog/uploads/assets/avatar.png"><p class="site-author-name" itemprop="name">Jacob Zhong</p><div class="site-description" itemprop="description">Blog of Jacob Zhong</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/blog/en/archives/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/blog/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/blog/en/tags/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/cmpute" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cmpute" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://www.linkedin.com/in/jacobzhong/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;jacobzhong&#x2F;" rel="noopener" target="_blank"><i class="linkedin-square fa-fw"></i>LinkedIn</a> </span><span class="links-of-author-item"><a href="mailto:cmpute@foxmail.com" title="E-Mail → mailto:cmpute@foxmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://www.last.fm/user/cmpute" title="Last.fm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;cmpute" rel="noopener" target="_blank"><i class="lastfm-square fa-fw"></i>Last.fm</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Friend Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://hanyuz1996.github.io/" title="https:&#x2F;&#x2F;hanyuz1996.github.io&#x2F;" rel="noopener" target="_blank">Hanyuz</a></li><li class="links-of-blogroll-item"><a href="https://xingminw.github.io/" title="https:&#x2F;&#x2F;xingminw.github.io&#x2F;" rel="noopener" target="_blank">Xingminw</a></li></ul></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/blog/en/uploads/assets/avatar.png"><meta itemprop="name" content="Jacob Zhong"><meta itemprop="description" content="Blog of Jacob Zhong"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jacob Zhong"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">进程、线程与协程 (C# vs Python)</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-11-07 00:57:31" itemprop="dateCreated datePublished" datetime="2019-11-07T00:57:31-05:00">2019-11-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-01-01 00:38:03" itemprop="dateModified" datetime="2023-01-01T00:38:03-05:00">2023-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/en/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/en/categories/Coding/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a> </span></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/blog/2019-11/ParallelismInPythonAndCsharp/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019-11/ParallelismInPythonAndCsharp/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><div class="note warning"><p><strong>This post was written in Chinese and hasn't been translated to English yet.</strong></p></div><p>近来由于项目需要，接触了一下一直没去了解过的 Python 异步语法，发现和之前我熟悉的 C# 有很多不同。在深入 Python 的异步逻辑之后，由于 Python 在语法上保留了很多语言机制的细节（比如成员函数的 <code>self</code> 参数），我反而对 C# 的异步有了更深的了解。这里就来重新梳理一下各种并行方法的区别，以及他们在 C# 和 Python 上实现的区别。（这里只讨论单机的并行机制。）</p><p>总的来说，并行机制主要有进程 (Process)、线程 (Thread) 和协程 (Coroutine)，其并行实现的开销依次递减，但是他们对每个任务的鲁棒性也是依次递减的。进程是操作系统资源分配的最小单元，线程则是能够被 CPU 并行处理的最小单元，而协程则是目前实现 “并行” 的最简单方法。一个进程中可以有多个线程，而一个线程中可以有多个协程。他们具体在特性上有以下区别</p><table><thead><tr><th></th><th>进程</th><th>线程</th><th>协程</th></tr></thead><tbody><tr><td>独立内存堆</td><td>√</td><td>×</td><td>×</td></tr><tr><td>独立处理器（可硬件并行）</td><td>√</td><td>√</td><td>×</td></tr><tr><td>独立上下文</td><td>√</td><td>√</td><td>×</td></tr><tr><td>独立栈、寄存器状态</td><td>√</td><td>√</td><td>√</td></tr></tbody></table><span id="more"></span><h1 id="进程">进程<a class="header-anchor" href="#进程"> ❮</a></h1><p>进程是系统层面实现并行的机制了，进程管理是现代操作系统的一大核心之一。进程之间互不影响，操作系统会保证一个程序崩溃了，其他程序以及系统内核不会崩溃。操作系统还会提供其他的进程管理功能，例如<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Scheduling_(computing)">进程调度</a>、设置进程优先级等等。不同语言底层对进程接口的实现实际上都是对系统接口的封装。</p><h2 id="一些概念">一些概念<a class="header-anchor" href="#一些概念"> ❮</a></h2><p>与进程相关的概念通常都是操作系统课程的必修知识哈哈：</p><ul><li>进程间通信 (Inter-process communiation, IPC)：故名思意。常用手段有管道、共享内存、信号量 (Semaphore)、消息队列等。</li><li>管道 (Pipe)：管道大概是进程间通信的最常用方式？分命名管道和匿名管道，进程双方均可往其中读写数据。</li><li>远程过程调用 (Remote procedure call): 远程过程调用通过特定的消息序列化手段，可以实现进程间通信，其使用形式是把一个 “远程” 的函数在本地进行执行。</li><li>进程锁：如果为了避免多个进程访问同一个资源的冲突的话，就会用到进程锁，其实现方法有<a target="_blank" rel="noopener" href="https://blog.csdn.net/luansxx/article/details/7736618">管道、信号量</a>、以及文件锁等。</li><li>文件锁：文件锁是实现进程互斥的一种常用手段，只需要建立空文件句柄并锁上就可了～并且文件锁还能做到权限控制，非常方便～</li></ul><h2 id="C">C#<a class="header-anchor" href="#C"> ❮</a></h2><p>C# 中对进程控制的模块主要通过 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/dotnet/api/system.diagnostics.process"><code>System.Diagnostics.Process</code></a>实现，可以实现建立进程、管理进程等，还可以指定具体的内存映射参数，如虚拟内存的页大小。而对管道的支持则是在 <code>Process</code> 类中有一部分，以及在 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.io.pipes"><code>System.IO.Pipe</code></a>里面有更全面的接口。我觉得这样的命名空间分类是挺合理的，<code>Process</code> 类的 API 其实只能用来进行程序调用和系统诊断，而 <code>Pipe</code> 则由于它和 <code>Stream</code> 的概念比较符合，因此归在 IO 空间下是合适的。</p><h2 id="Python">Python<a class="header-anchor" href="#Python"> ❮</a></h2><p>Python 中对进程的控制以及通信方法的实现都在 <code>multiprocess</code> 包里，它的一些具体使用方法可以参考<a href="/blog/en/2017-12/PythonCall/" title="另一篇之前的博文">另一篇之前的博文</a>。值得一提的是，Python 中还针对 Unix 系统提供了 <code>fcntl</code>, <code>posix</code> 等库专门用来调用系统底层 API，这些 API 有部分是和进程有关的。相关内容还是查阅对应的资料会比较清楚～</p><h1 id="线程">线程<a class="header-anchor" href="#线程"> ❮</a></h1><p>线程是进程中细化的并行机制，线程的实现也需要用到操作系统的接口，不过线程的创建的管理基本都是在进程内部完成的。由于线程之间不独立内存空间，因此在 C++ 这种能够随意操作内存的语言中，一个线程崩了，这个进程也大概率就崩了。但是在 C# 和 Python 中，由于有比较完善的 Exception 机制，并且没有什么机会直接操作内存，一般线程崩了主进程还是能接着跑的。多线程想必应该是大家用的最多的并行方法了～</p><h2 id="一些概念-2">一些概念<a class="header-anchor" href="#一些概念-2"> ❮</a></h2><p>在线程里面又有一些新的概念</p><ul><li>线程池 (Thread pool)：线程池与内存池相似，都是为了避免频繁新建和销毁线程 (or 内存) 而造成额外的开销</li><li>线程锁：线程锁与进程锁相似，是为了避免线程间访问同样的资源而产生冲突（例如 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34510/what-is-a-race-condition">race condition</a>）。线程间产生访问冲突非常常见，因此程序员掌握线程锁的使用是非常必要的。线程锁在 C++ 中的 <code>&lt;mutex&gt;</code> 有非常全面的实现。这里面锁的类型具有代表性，分为条件锁、自旋锁等等，具体区别可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/bian_qing_quan11/article/details/73734157">这篇博客</a>。C++ 的多线程非常令人头大... 这里就不展开了。</li><li>事件 (Event)：在多线程体系中，事件是一种常用于线程同步的机制，如果线程需要在运行过程中等待其他线程的运行，就可以使用事件机制。</li></ul><h2 id="C-2">C#<a class="header-anchor" href="#C-2"> ❮</a></h2><p>C# 中与线程相关的模块在 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/dotnet/api/system.threading"><code>System.Threading</code></a>空间下。<code>System.Threading.Thread</code> 提供了线程实现的类，使用 delegate 即可创建线程对象。这个空间底下也提供了 <code>SpinLock</code>、<code>Semaphore</code>、<code>Mutex</code> 等线程锁，以及 <code>AutoResetEvent</code> 实现了事件机制。<code>System.Threading.ThreadPool</code> 则提供了线程池的实现。另外需要指出的是 C# 提供了 <code>lock</code> 关键字，只需对冲突的对象使用 <code>lock</code> 锁上，那么在其对应的上下文中就能够避免冲突。</p><h2 id="Python-2">Python<a class="header-anchor" href="#Python-2"> ❮</a></h2><p>Python 中与线程相关的对象在 <a target="_blank" rel="noopener" href="https://docs.python.org/library/threading.html"><code>threading</code></a>模块中，其中 <code>Thread</code> 类提供了线程实现，<code>Lock</code>, <code>Semaphore</code> 提供了线程锁，<code>Event</code> 实现了事件机制。Python 中可以使用 <code>with lock:</code> 这样的块实现与 C#<code>lock</code> 相似的语法，但是这个地方的 lock 仍然需要自己声明，不如 C# 和 Java 中的 <code>lock</code> 用着方便。</p><p>总体而言 C# 和 Python 对多线程机制的支持都比较全面，然而 CPython 有一个臭名昭著的<a target="_blank" rel="noopener" href="http://cenalulu.github.io/python/gil-in-python/">全局锁 GIL</a>，使得其多线程效率大幅下降。因此在很多 Python 库中，大家宁愿使用 <code>multiprocess</code> 多进程来进行并行（即便需要处理进程间通信的问题），也不愿使用 <code>threading</code> 来完成并行任务。这一点上不得不说 Python 辣鸡！</p><h1 id="协程">协程<a class="header-anchor" href="#协程"> ❮</a></h1><p>协程应该是 21 世纪才用的比较多的技术了，并且这个概念应该是在 Go 里面提的最多。在前文我提到协程是并行时打了引号，这是因为协程本质上还是同一个时刻只能干一件事，没法利用硬件并行，因此我们形容协程都是用 “异步”(Asychronized) 而不是 “并行”(Parallel)。异步是与同步相对的，只要程序能一会干点这个，一会干点那个，不按顺序来，那就可以称作异步了。协程的广泛应用是由于近些年大型服务器的负载越来越大，并发需求越来越高（<s>同时剁手的人越来越多</s>），多任务切换的开销越来越不可忽视，因此协程这个开销最小的方法就被广泛应用了。协程实际上不是一个比线程更小的概念，而是另一类概念（并行 / 串行 vs 异步 / 同步)。协程的特点是一个任务能够跑到一半就暂停，然后把状态存起来，等到需要的东西备齐了以后再把状态复原接着跑；至于暂停之前和之后是不是在同一个线程上跑、有没有跟别的任务一块跑并不重要。因此实际上协程是回调 (Callback) 机制的一个封装升级。</p><blockquote><p>实际上不依赖于系统线程的并行技术不止协程一种，以下内容<a target="_blank" rel="noopener" href="https://softwareengineering.stackexchange.com/a/254141">来自 StackExchange 的一个回答</a>：<br>A Fiber is a lightweight thread that uses cooperative multitasking instead of preemptive multitasking. A running fiber must explicitly "yield" to allow another fiber to run, which makes their implementation much easier than kernel or user threads.</p><p>A Coroutine is a component that generalizes a subroutine to allow multiple entry points for suspending and resuming execution at certain locations. Unlike subroutines, coroutines can exit by calling other coroutines, which may later return to the point where they were invoked in the original coroutine.</p><p>A Green Thread is a thread that is scheduled by a virtual machine (VM) instead of natively by the underlying operating system. Green threads emulate multithreaded environments without relying on any native OS capabilities, and they are managed in user space instead of kernel space, enabling them to work in environments that do not have native thread support.</p></blockquote><h2 id="一些概念-3">一些概念<a class="header-anchor" href="#一些概念-3"> ❮</a></h2><ul><li>事件循环 (Event loop)：事件循环是一种非常简单的实现异步的机制，简而言之就是维护一个队列，然后把队列里的任务挨个执行，而任务随时随地可以被添加进队列。</li><li>异步执行 / 等待 (async/await)：这两个关键词在多个语言中都有出现。async 用来修饰函数，说明这个函数可以异步执行；await 用来等待异步函数的结束，如果没有结束就把当前任务搁着。</li></ul><h2 id="C-3">C#<a class="header-anchor" href="#C-3"> ❮</a></h2><p>C# 中没有协程的概念，C# 在 5.0 版本中引入的 <code>async</code>/<code>await</code> 关键字提供了异步执行的接口。据我所知 C# 应该是最早一批引入这个概念的语言了，并且 C# 里面 async 和 await 的使用非常顺滑～。C# 的 async/await 调度与 Go 一样，都是通过线程池实现，因此性能也非常不错。C# 中与 async/await 有关的接口在 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks%60"><code>System.Threading.Tasks</code></a>下，里面的 <code>Task</code> 类型是对能够 await 的对象的封装。</p><p>C# 中也有用到 Event loop 来实现异步的地方，一般是在 UI 相关的函数中，例如整个 C# 里面的 <code>event</code> 机制都是通过事件循环来实现的。使用事件循环来完成与 UI 相关的异步应该是非常标准的做法了，例如 Qt 里面也有 <code>QEventLoop</code> 来实现 UI 的异步回调。与 Event loop 相关的是 Dispatcher 机制，Dispatcher 可以将指定任务加进事件循环中执行，例如在 WPF 中可以用 Window 的 Dispatcher 在其他线程中将任务加进 UI 主线程。</p><p>另外需要指出的是 C# 还可以通过 <code>yield</code> 关键词实现异步，<code>yield return</code> 可能是 C# 最早的异步机制了，不过功能有限，只能与 <code>IEnumerable</code> 合作使用。C# 中有一些协程的库（如 Unity 里的）就是使用 <code>yield</code> 机制来实现的。具体怎么使用 <code>yield</code> 还请去学习 C# 的语法～</p><h2 id="Python-3">Python<a class="header-anchor" href="#Python-3"> ❮</a></h2><p>Python 对异步的支持就来的比较晚了，直到 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0492/">PEP 492</a> 才正式加入了对 <code>async</code> 关键字的支持，放在了 <code>asyncio</code> 模块中。Python 对这对关键词的实现又很辣鸡了，<a target="_blank" rel="noopener" href="https://robertoprevato.github.io/Comparisons-of-async-await/">采用的是 Event loop 机制来实现</a>（可能是因为多线程性能太差了吧 = =）。最让人蛋疼是为了执行异步函数你还需要自己开 event loop，如果你之前开过一个了，那你还需要把之前那个 loop 找回来，然后 dispatch 进去，这是何其难受！。。</p><p>Python 中只要对象有<code>__await__</code>、<code>__aiter__</code>或者<code>__aenter__</code>就可以分别支持 <code>await</code>、<code>async for</code> 和 <code>async with</code> 的代码块。Python 还设计了三个相关概念：Coroutine 代表异步对象、Task 代表异步执行计划、Future 代表异步执行结果。。何必呢？？？像 C# 用一个 Task 代表全部不行吗？再配合 event loop 的接口，就产生了 <code>create_task</code>、<code>run_coroutine_threadsafe</code>、<code>run_until_complete</code>、<code>run_in_executor</code> 等我总是搞不清区别的函数。。。我爱 C#！</p><hr>以上是我对C#和Python中异步机制的总结，我对各语言底层的了解并不深，如有错漏还请指点~</div><footer class="post-footer"><div class="reward-container"><div>Treat me some coffee XD</div><button>Donate</button><div class="post-reward"><div><img src="/blog/uploads/assets/wechatpay.jpg" alt="Jacob Zhong WeChat Pay"> <span>WeChat Pay</span></div><div><img src="/blog/uploads/assets/alipay.jpg" alt="Jacob Zhong Alipay"> <span>Alipay</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>Post author: </strong>Jacob Zhong</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/" title="进程、线程与协程 (C# vs Python)">http://zyxin.xyz/blog/2019-11/ParallelismInPythonAndCsharp/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="post-tags"><a href="/blog/en/tags/Python/" rel="tag"># Python</a> <a href="/blog/en/tags/C/" rel="tag"># C#</a> <a href="/blog/en/tags/Parallelism/" rel="tag"># Parallelism</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/en/2019-08/CythonArray/" rel="prev" title="在 Cython 中操作数组"><i class="fa fa-chevron-left"></i> 在 Cython 中操作数组</a></div><div class="post-nav-item"><a href="/blog/en/2020-05/TerminalControlCharacters/" rel="next" title="终端的特殊控制符">终端的特殊控制符 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-disqus">Disqus Comments</a></li><li class="tab"><a href="#comment-livere">LiveRe Comments</a></li></ul><div class="tab-content"><div class="tab-pane disqus" id="comment-disqus"><div class="comments" id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div><div class="tab-pane livere" id="comment-livere"><div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81NDQ2Ni8zMDkzNw=="></div></div></div></div></div></main><footer class="footer"><div class="footer-inner"><div class="languages"><label class="lang-select-label"><i class="fa fa-language"></i> <span>English</span> <i class="fa fa-angle-up" aria-hidden="true"></i></label> <select class="lang-select" data-canonical="" aria-label="Select language"><option value="en" data-href="/blog/2019-11/ParallelismInPythonAndCsharp/" selected>English</option><option value="zh-CN" data-href="/blog/zh-CN/2019-11/ParallelismInPythonAndCsharp/" selected>简体中文</option></select></div><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fire"></i> </span><span class="author" itemprop="copyrightHolder">Jacob Zhong</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script><script src="/blog/js/pjax.js"></script><script src="/blog/js/third-party/pace.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script><script src="/blog/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"jacob-zhongs-blog","count":true,"i18n":{"disqus":"disqus"}}</script><script src="/blog/js/third-party/comments/disqus.js"></script><script src="/blog/js/third-party/comments/livere.js"></script></body></html>