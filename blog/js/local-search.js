window.addEventListener("DOMContentLoaded",()=>{let e=false;let t;let r=true;let l=CONFIG.path;if(l.length===0){l="search.xml"}else if(/json$/i.test(l)){r=false}const n=CONFIG.root+l;const o=document.getElementById("search-input");const s=document.getElementById("search-result");const i=e=>{return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x3A;/g,":").replace(/&#(\d+);/g,(e,t)=>{return String.fromCharCode(t)}).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};const c=(e,t,r)=>{let l=e.length;if(l===0)return[];let n=0;let o=[];let s=[];if(!r){t=t.toLowerCase();e=e.toLowerCase()}while((o=t.indexOf(e,n))>-1){s.push({position:o,word:e});n=o+l}return s};const a=(e,t,r,l)=>{let n=r[r.length-1];let{position:o,word:s}=n;let i=[];let c=0;while(o+s.length<=t&&r.length!==0){if(s===l){c++}i.push({position:o,length:s.length});let e=o+s.length;r.pop();while(r.length!==0){n=r[r.length-1];o=n.position;s=n.word;if(e>o){r.pop()}else{break}}}return{hits:i,start:e,end:t,searchTextCount:c}};const h=(e,t)=>{let r="";let l=t.start;t.hits.forEach(t=>{r+=e.substring(l,t.position);let n=t.position+t.length;r+=`<b class="search-keyword">${e.substring(t.position,n)}</b>`;l=n});r+=e.substring(l,t.end);return r};const u=()=>{let e=o.value.trim().toLowerCase();let r=e.split(/[-\s]+/);if(r.length>1){r.push(e)}let l=[];if(e.length>0){t.forEach(t=>{if(!t.title)return;let n=0;let o=t.title.trim();let s=o.toLowerCase();let u=t.content?t.content.trim().replace(/<[^>]+>/g,""):"";if(CONFIG.localsearch.unescape){u=i(u)}let p=u.toLowerCase();let d=decodeURIComponent(t.url).replace(/\/{2,}/g,"/");let f=[];let g=[];r.forEach(e=>{f=f.concat(c(e,s,false));g=g.concat(c(e,p,false))});if(f.length>0||g.length>0){let t=f.length+g.length;[f,g].forEach(e=>{e.sort((e,t)=>{if(t.position!==e.position){return t.position-e.position}return e.word.length-t.word.length})});let r=[];if(f.length!==0){let t=a(0,o.length,f,e);n+=t.searchTextCountInSlice;r.push(t)}let s=[];while(g.length!==0){let t=g[g.length-1];let{position:r,word:l}=t;let o=r-20;let i=r+80;if(o<0){o=0}if(i<r+l.length){i=r+l.length}if(i>u.length){i=u.length}let c=a(o,i,g,e);n+=c.searchTextCountInSlice;s.push(c)}s.sort((e,t)=>{if(e.searchTextCount!==t.searchTextCount){return t.searchTextCount-e.searchTextCount}else if(e.hits.length!==t.hits.length){return t.hits.length-e.hits.length}return e.start-t.start});let i=parseInt(CONFIG.localsearch.top_n_per_article,10);if(i>=0){s=s.slice(0,i)}let c="";if(r.length!==0){c+=`<li><a href="${d}" class="search-result-title">${h(o,r[0])}</a>`}else{c+=`<li><a href="${d}" class="search-result-title">${o}</a>`}s.forEach(e=>{c+=`<a href="${d}"><p class="search-result">${h(u,e)}...</p></a>`});c+="</li>";l.push({item:c,searchTextCount:n,hitCount:t,id:l.length})}})}if(r.length===1&&r[0]===""){s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'}else if(l.length===0){s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'}else{l.sort((e,t)=>{if(e.searchTextCount!==t.searchTextCount){return t.searchTextCount-e.searchTextCount}else if(e.hitCount!==t.hitCount){return t.hitCount-e.hitCount}return t.id-e.id});let e='<ul class="search-result-list">';l.forEach(t=>{e+=t.item});e+="</ul>";s.innerHTML=e;window.pjax&&window.pjax.refresh(s)}};const p=l=>{fetch(n).then(e=>e.text()).then(n=>{e=true;t=r?[...(new DOMParser).parseFromString(n,"text/xml").querySelectorAll("entry")].map(e=>{return{title:e.querySelector("title").innerHTML,content:e.querySelector("content").innerHTML,url:e.querySelector("url").innerHTML}}):JSON.parse(n);document.querySelector(".search-pop-overlay").innerHTML="";document.body.style.overflow="";if(l){l()}})};if(CONFIG.localsearch.preload){p()}const d=()=>{document.body.style.overflow="hidden";document.querySelector(".search-pop-overlay").style.display="block";document.querySelector(".popup").style.display="block";document.getElementById("search-input").focus()};const f=()=>{document.querySelector(".search-pop-overlay").style.display="";document.querySelector(".search-pop-overlay").innerHTML='<div class="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div>';p(d)};if(CONFIG.localsearch.trigger==="auto"){o.addEventListener("input",u)}else{document.querySelector(".search-icon").addEventListener("click",u);o.addEventListener("keypress",e=>{if(e.keyCode===13){u()}})}document.querySelector(".popup-trigger").addEventListener("click",()=>{if(e===false){f()}else{d()}});const g=()=>{document.body.style.overflow="";document.querySelector(".search-pop-overlay").style.display="none";document.querySelector(".popup").style.display="none"};document.querySelector(".search-pop-overlay").addEventListener("click",g);document.querySelector(".popup-btn-close").addEventListener("click",g);window.addEventListener("pjax:success",g);window.addEventListener("keyup",e=>{if(e.which===27){g()}})});